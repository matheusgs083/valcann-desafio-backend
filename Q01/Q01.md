# Desafio Back-End — Questão 1

## Modelo Conceitual (MER)

O modelo foi desenhado para representar Benchmarks, seus Controles e o histórico de mudanças de estado de cada controle.

### Entidades

- **Benchmark**
  - `id` (PK, INDEX)
  - `nome` (INDEX opcional)

- **Controle**
  - `id` (PK, INDEX)
  - `benchmark_id` (FK → Benchmark_id, INDEX)
  - `nome`
  - `descricao`

- **EstadoControle**
  - `id` (PK, INDEX)
  - `controle_id` (FK → Controle_id, INDEX)
  - `estado` (`ok | alarm`)
  - `alterado em` (timestamp, INDEX junto com `controle_id`)

### Relacionamentos
- **Benchmark (1) — (N) Controle**
- **Controle (1) — (1) EstadoControle**

---

- **Benchmark possui varios controles**
- **Controle percence a um benchmark**
- **Benchmark possui um estado**

---

## Cenários Atendidos

1. **Listar Benchmark com seus Controles e estado atual**
   - Buscar o último registro (`MAX(alterado_em)`) de cada `Controle`.

2. **Listar Benchmark com seus Controles e mudanças de estado em intervalo**
   - Filtrar `EstadoControle.alterado_em BETWEEN data_inicial AND data_final`.

3. **Obter Benchmark com seus Controles e estado em data/hora X**
   - Selecionar o registro mais recente (`alterado_em <= X`) para cada controle.

---

## Índices Utilizados

- **PKs em todas as tabelas**
  - Garantem unicidade e performance em joins.

- **FKs indexadas**
  - `Controle.benchmark_id`
  - `EstadoControle.controle_id`

- **Índice composto em `EstadoControle (controle_id, alterado_em)`**
  - Acelera consultas por:
    - último estado de um controle (Q1)
    - mudanças em intervalo (Q2)
    - estado em uma data/hora X (Q3)

- **Índice em nomes (`Benchmark.name`, `Controle.name`) [opcional]**
  - Útil para buscas textuais.

---

## Diagrama MER

![MER - Feito com auxilio do site 'https://app.diagrams.net/' ](../assets/benchmark.png)
